<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport"    content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author"      content="Sergey Pozhilov (GetTemplate.com)">

	<title>Posts</title>

	<link rel="shortcut icon" href="/images/gt_favicon.png">

	
	<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.no-icons.min.css" rel="stylesheet">
	
	<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alice|Open+Sans:400,300,700">
	
	<link rel="stylesheet" href="/css/styles.css">

	

    
        <script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=123456789012345678901234&product=inline-share-buttons"></script>
    

</head>
<body class="home">

<header id="header">
	<div id="head" class="parallax" parallax-speed="2">
		<h1 id="logo" class="text-center">
			
			<span class="title">Statistics and Data Analysis Unit</span>
			<span class="tagline">Patient-focused research collaboration in the areas of data and statistics<br>
				<a href="https://www.ucc.ie/en/crfc/"><u>HRB Clinical Research Facility - Cork</u></a>
            </span>
		</h1>
	</div>

    <nav class="navbar navbar-default navbar-sticky">
    <div class="container-fluid">

        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="true">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <div class="navbar-collapse collapse" id="bs-example-navbar-collapse-1">

            <ul class="nav navbar-nav">
                
                <li>
                    <a href="/">home</a>
                </li>
                
                <li>
                    <a href="/post/">blog</a>
                </li>
                
                <li>
                    <a href="/support/">Support</a>
                </li>
                
                <li>
                    <a href="/education/">Education</a>
                </li>
                
                <li>
                    <a href="/about/">Our team</a>
                </li>
                
                
            </ul>

        </div>
    </div>
</nav>


</header>


<main id="main">

	<div class="container">
		<div class="row topspace">
			<div class="col-sm-8 col-sm-offset-2">

                
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
							<span class="posted-on"><time class="entry-date published" date="2020-02-10 12:00:00 &#43;0000 UTC">February 10, 2020</time></span>
						</div>
						<h1 class="entry-title"><a href="/post/hrbdataevent/" rel="bookmark">Data Management in Health Research: You&#39;re funded but are you FAIR?</a></h1>
					</header>
					<div class="entry-content">
						<p>This 2-day event will run on Tuesday 7th and Wednesday 8th April 2020 <a href="https://www.ucc.ie/">University College Cork</a>.</p>

<p><strong>Background:</strong></p>

<p>Research funding is evolving and the onus now rests on primary researchers to plan the collection and curation of research data with a view to maximise its availability, together with the software and materials that underpin it.</p>

<p>From the 1st January 2020, data gathered and generated in whole or in part from Health Research Board (HRB) funded research will subject to the HRB policy on Management and Sharing of Research Data.</p>

<p><strong>Target audience:</strong></p>

<p><em>Day 1 - Symposium:</em> Research leaders, PIs and post-docs currently, or actively seeking, grants funded by the HRB.</p>

<p><em>Day 2 - Workshop:</em> Researchers actively engaged with data collection, curation and management as part of HRB-funded research.</p>

<p><strong>Aims:</strong></p>

<p><em>Day 1</em> - To provide an overview of HRB policy, hear from researchers currently engaged in HRB-funded research and to hear from researchers already benefiting from adoption of improved data management policies in their own organisation(s).</p>

<p><em>Day 2</em> - To provide guidance to researchers tasked with employing data management protocols. Instruction will be given on both quantitative and qualitative data types through the lens of the <a href="https://www.nature.com/articles/sdata201618">FAIR data principles</a> (Findable, Accessible, Interoperable, Re-usable).</p>

<p><img src="https://crfcsdau.github.io/images/library.jpg" alt="" /></p>

<p>To register for the event, please follow this <a href="https://conference.ucc.ie/data-management-in-health-research-youre-funded-but-are-you-fair/register/Site/Register">link</a>.</p>

<p><strong>Speakers/Facilitators:</strong></p>

<ul>
<li><a href="https://www.rcsi.com/people/profile/kathleenebennett">Prof Kathleen Bennett</a> – Royal College of Surgeons in Ireland</li>
<li><a href="https://blog.hrbopenresearch.org/author/patricia-clarke/">Patricia Clarke</a> – Health Research Board</li>
<li><a href="https://libguides.ucc.ie/researchdataservice">Dr Aoife Coffey</a> – University College Cork</li>
<li><a href="https://crfc.ucc.ie/team-members/dr-darren-dahly/">Dr Darren Dahly</a> – University College Cork</li>
<li><a href="https://www.maynoothuniversity.ie/people/jane-gray">Prof Jane Gray</a> – Maynooth University</li>
<li><a href="https://www.isdscotland.org/About-ISD/Our-Organisation/">Scott Heald</a> – NHS Scotland</li>
<li><a href="https://www.hse.ie/eng/about/who/healthwellbeing/knowledge-management/about-us/the-team/">Dr Howard Johnson</a> – Health Service Executive</li>
<li><a href="https://ie.linkedin.com/in/annalisa-montesanti-9b308431">Annalisa Montesanti</a> – Health Research Board</li>
<li><a href="https://www.cardiff.ac.uk/people/view/1156533-morey-candice">Dr Candice Morey</a> - Cardiff University</li>
<li><a href="https://www.ucc.ie/en/support/library/people/eoghanocarragain/">Eoghan O Carragáin</a> – University College Cork</li>
<li><a href="https://crfc.ucc.ie/team-members/dr-brendan-palmer/">Dr Brendan Palmer</a> – University College Cork</li>
<li><a href="https://blog.hrbopenresearch.org/author/aileen-sheehy/">Aileen Sheehy</a> – Health Research Board</li>
<li><a href="https://hrcdc.ie/about-us/">Emily Vereker</a> – Health Research Consent Declaration Committee</li>
</ul>

<p><strong>Topics covered will include:</strong></p>

<ul>
<li><a href="https://www.hrb.ie/funding/funding-schemes/before-you-apply/all-grant-policies/hrb-policy-on-management-and-sharing-of-research-data/">HRB policy on Management and Sharing of Research data</a></li>
<li>Application of <a href="https://www.go-fair.org/fair-principles/">FAIR data principles</a> to quantitative and qualitative research data</li>
<li><a href="https://www.hrb.ie/funding/gdpr-guidance-for-researchers/health-research-regulations-2018/">Health Research Regulations</a> and the <a href="https://hrcdc.ie/">Health Research Consent Declaration Committee</a></li>
</ul>

<p><strong>Preliminary Schedule</strong></p>

<p><img src="https://crfcsdau.github.io/images/Day1-schedule.png" alt="" /></p>

<p><img src="https://crfcsdau.github.io/images/Day2-schedule.png" alt="" /></p>

					</div>
				</article>
                
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
							<span class="posted-on"><time class="entry-date published" date="2019-04-21 00:00:00 &#43;0000 UTC">April 21, 2019</time></span>
						</div>
						<h1 class="entry-title"><a href="/post/homr/" rel="bookmark">Evaluating a logistic regression based prediction tool in R</a></h1>
					</header>
					<div class="entry-content">
						<p>This is a tutorial on how to use R to evaluate a previously published prediction tool in a new dataset. Most of the good ideas came from <a href="https://twitter.com/MaartenvSmeden">Maarten van Smeden</a>, and any mistakes are surely mine. This post is not intended to explain they <em>why</em> one might do what follows, but rather <em>how</em> to do it in R.</p>
<p>It is based on a recent analysis we published (in press) that validated the <a href="http://dx.doi.org/10.1016/j.jclinepi.2014.05.003">HOMR</a> model to predict all-cause mortality within one-year of a hospitalization in a cohort of patients aged 65 years or older that were under the care of geriatric medicine service at Cork University Hospital (2013-01-01 to 2015-03-06). The predictors used in the HOMR model were generally things that are easy enough to collect during hospitalization. You can read all about it in the paper linked above.</p>
<p>All materials for the analysis can be found on the <a href="https://osf.io/tv26k/">project’s OSF page</a>.</p>
<pre class="r"><code>  data &lt;- read_csv(&quot;https://crfcsdau.github.io/public/homr_data.csv&quot;) 
  data$alive &lt;- factor(data$alive, levels = c(&quot;Yes&quot;, &quot;No&quot;))</code></pre>
<div id="calculating-the-homr-score" class="section level2">
<h2>Calculating the HOMR score</h2>
<p>The first step in evaluating the HOMR model in our cohort of patients was to calculate the linear predictor (Z) for each of them. This was done by multiplying the fitted regression coefficients (on the log-odds scale; found in appendix E of the <a href="http://dx.doi.org/10.1016/j.jclinepi.2014.05.003">HOMR development paper</a>) by each patient’s respective variable values, and then adding them all together, including the intercept term (<code>data$z_homr</code>).</p>
<p>The original HOMR development paper also provided a set of tables to calculate a score based on the predictors (<code>data$homr_3</code>). However, these scores are just a rescaled version of Z that gives you a set of integer values that can be easily added together from simple tables to get a prediction. However, since there was considerable rounding error (as you can see from the plot below), we used Z instead of the HOMR score in our evaluation.</p>
<p><strong>Figure 1.</strong> The relationship between the HOMR score and the HOMR linear predictor (Z) in our cohort of patients.</p>
<pre class="r"><code>  ggplot(data, aes(x = z_homr, y = homr_3)) +
    geom_point(alpha = 0.2, size = 2, color = viridis(1, begin = 0.5)) +
    xlab(&quot;HOMR linear predictor (log odds scale)&quot;) +
    ylab(&quot;HOMR score&quot;) +
    theme_minimal()</code></pre>
<p><img src="/post/homr_files/figure-html/score_vs_z_scatter-1.svg" width="768" /></p>
</div>
<div id="evaluating-the-model-overview" class="section level2">
<h2>Evaluating the model: Overview</h2>
<p>To evaluate the HOMR Model, we followed the procedure outlined in <a href="https://doi.org/10.1002/sim.7179">Vergouwe et al (2016)</a> and estimated four logistic regression models. The first included the HOMR linear predictor, with its coefficient set equal to 1, and intercept set to zero (<strong>the original HOMR model</strong>). The second model allowed the intercept to be freely estimated (<strong>Recalibration in the Large</strong>). The third then allowed the coefficient on the HOMR linear predictor to be freely estimated as well (<strong>Logistic Recalibration</strong>). Finally, the fourth model included the complete set variables used in the HOMR model, including the same transformations and interactions, and allowed their respective coefficients to be freely estimated (<strong>Model Revision</strong>). Here is the code for executing those models:</p>
<pre class="r"><code># HOMR (intercept = 0 and beta = 1)
  m1 &lt;- glm(alive ~ -1 + offset(z_homr), data = data, family = binomial)
# Recalibration in the Large (estimate intercept, beta = 1)
  m2 &lt;- glm(alive ~  1 + offset(z_homr), data = data, family = binomial)
# Logisitic Calibration (estimate both)
  m3 &lt;- glm(alive ~  1 +        z_homr,  data = data, family = binomial)
# Model Revision
  data2 &lt;- data
  data2$admit_service &lt;- as.character(data2$admit_service)
  data2$admit_service &lt;- factor(
    ifelse( # Sparse cells, so this was collapsed to binary
    data2$admit_service == &quot;General Medicine&quot;, 
    data2$admit_service, 
    &quot;Other&quot;
    )
  )
  
  formula_4 &lt;- as.formula(
    &quot;alive ~  1 + drs + sqrt_age + sex + living_status + log_cci +
    trans_ed + trans_amb + admit_service + urgency_admit + urgent_readmit +      
    (sqrt_age * log_cci) + (living_status * trans_amb) + 
    (urgency_admit * trans_amb)&quot;
    )

  m4 &lt;- glm(formula_4, data = data2, family = binomial)
  
# Model predicted probabilties
  data$m1_pred &lt;- predict(m1, type = &quot;response&quot;)
  data$m2_pred &lt;- predict(m2, type = &quot;response&quot;)
  data$m3_pred &lt;- predict(m3, type = &quot;response&quot;)
  data$m4_pred &lt;- predict(m4, type = &quot;response&quot;)</code></pre>
<p>The overall performance of these models was evaluated using the Brier score, rescaled to range from 0 to 1 (with higher values indicating better performance) as suggested by <a href="https://doi.org/10.1097/EDE.0b013e3181c30fb2">Steyerberg et al (2010)</a>. We assessed calibration graphically, in addition to using the maximum and average difference in predicted vs loess-calibrated probabilities (Emax and Eavg); and we used the c-statistic to assess discrimination. For each of these metrics, we reported bootstrapped 95% confidence intervals. Finally, for <strong>Model Revision</strong>, we estimated an optimism-corrected c-statistic and shrinkage factor using bootstrapping, as described in <a href="https://doi-org.ucc.idm.oclc.org/10.1002/(SICI)1097-0258(19960229)15:4%3C361::AID-SIM168%3E3.0.CO;2-4">Harrell, Lee and Mark (1996)</a></p>
<p>To get most metrics, we used <code>rms::val.prob</code> as follows:</p>
<pre class="r"><code># Metrics  
  val_m1 &lt;- val.prob(data$m1_pred, as.numeric(data$alive) - 1, 
                     pl = FALSE) %&gt;% round(3)
  val_m2 &lt;- val.prob(data$m2_pred, as.numeric(data$alive) - 1, 
                     pl = FALSE) %&gt;% round(3)
  val_m3 &lt;- val.prob(data$m3_pred, as.numeric(data$alive) - 1, 
                     pl = FALSE) %&gt;% round(3)
  val_m4 &lt;- val.prob(data$m4_pred, as.numeric(data$alive) - 1, 
                     pl = FALSE) %&gt;% round(3)
  
  rescale_brier &lt;- function(x, p, ...){ 
    format(round(1 - (x / (mean(p) * (1 - mean(p)))), digits = 2), nsmall = 2)
  }
  
  b1 &lt;- rescale_brier(val_m1[&quot;Brier&quot;], 0.184) 
  b2 &lt;- rescale_brier(val_m2[&quot;Brier&quot;], 0.184)
  b3 &lt;- rescale_brier(val_m3[&quot;Brier&quot;], 0.184)
  b4 &lt;- rescale_brier(val_m4[&quot;Brier&quot;], 0.184)
# Note: 0.184 is the marginal probabilty of death in the entire sample</code></pre>
<p>Here is what the <code>rms::val.prob</code> output looks like.</p>
<pre class="r"><code>  pander(val_m1) </code></pre>
<table>
<caption>Table continues below</caption>
<colgroup>
<col width="10%" />
<col width="13%" />
<col width="9%" />
<col width="10%" />
<col width="14%" />
<col width="8%" />
<col width="10%" />
<col width="14%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Dxy</th>
<th align="center">C (ROC)</th>
<th align="center">R2</th>
<th align="center">D</th>
<th align="center">D:Chi-sq</th>
<th align="center">D:p</th>
<th align="center">U</th>
<th align="center">U:Chi-sq</th>
<th align="center">U:p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0.564</td>
<td align="center">0.782</td>
<td align="center">0.22</td>
<td align="center">0.145</td>
<td align="center">204.6</td>
<td align="center">NA</td>
<td align="center">0.021</td>
<td align="center">32.23</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="16%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="12%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Q</th>
<th align="center">Brier</th>
<th align="center">Intercept</th>
<th align="center">Slope</th>
<th align="center">Emax</th>
<th align="center">E90</th>
<th align="center">Eavg</th>
<th align="center">S:z</th>
<th align="center">S:p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0.123</td>
<td align="center">0.127</td>
<td align="center">-0.428</td>
<td align="center">0.985</td>
<td align="center">0.103</td>
<td align="center">0.102</td>
<td align="center">0.058</td>
<td align="center">-3.806</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>Uncertainty in these metrics was evaluated with bootstrapping.</p>
<pre class="r"><code>  set.seed(48572)

  boot_val &lt;- function(data, formula, ...){
    out &lt;- list()
    for(i in 1:500){
      df &lt;- sample_n(data, nrow(data), replace = TRUE)
      md &lt;- glm(formula, data = df, family = binomial)
      out[[i]] &lt;- val.prob(predict(md, type = &quot;response&quot;),
                           as.numeric(df$alive) - 1, 
                           pl = FALSE) %&gt;% round(3)
    }
    return(out)
  }

  boot_vals_m1 &lt;- boot_val(data,  as.formula(&quot;alive ~ -1 + offset(z_homr)&quot;))
  boot_vals_m2 &lt;- boot_val(data,  as.formula(&quot;alive ~  1 + offset(z_homr)&quot;))
  boot_vals_m3 &lt;- boot_val(data,  as.formula(&quot;alive ~  1 +        z_homr &quot;))
  boot_vals_m4 &lt;- boot_val(data2, formula_4) </code></pre>
<p>This code just pulls out 95% intervals from the bootstrapped values.</p>
<pre class="r"><code>  calc_ci &lt;- function(metric, boot_vals, n){
    x &lt;- unlist(map(boot_vals, `[`, c(metric)))
    if(metric == &#39;Brier&#39;){x &lt;- as.numeric(rescale_brier(x, 0.184))}
    paste0(&quot;(&quot;, round(quantile(x, 0.025), n), &quot; to &quot;, 
           round(quantile(x, 0.975), n), &quot;)&quot;)
  }

# m1
  m1_c_boot_ci     &lt;- calc_ci(&quot;C (ROC)&quot;, boot_vals_m1, 2)
  m1_brier_boot_ci &lt;- calc_ci(&quot;Brier&quot;,   boot_vals_m1, 2)
  m1_emax_boot_ci  &lt;- calc_ci(&quot;Emax&quot;,    boot_vals_m1, 2)
  m1_eavg_boot_ci  &lt;- calc_ci(&quot;Eavg&quot;,    boot_vals_m1, 2)

# m2
  m2_c_boot_ci     &lt;- calc_ci(&quot;C (ROC)&quot;, boot_vals_m2, 2)
  m2_brier_boot_ci &lt;- calc_ci(&quot;Brier&quot;,   boot_vals_m2, 2)
  m2_emax_boot_ci  &lt;- calc_ci(&quot;Emax&quot;,    boot_vals_m2, 2)
  m2_eavg_boot_ci  &lt;- calc_ci(&quot;Eavg&quot;,    boot_vals_m2, 2)
  
# m3
  m3_c_boot_ci     &lt;- calc_ci(&quot;C (ROC)&quot;, boot_vals_m3, 2)
  m3_brier_boot_ci &lt;- calc_ci(&quot;Brier&quot;,   boot_vals_m3, 2)
  m3_emax_boot_ci  &lt;- calc_ci(&quot;Emax&quot;,    boot_vals_m3, 2)
  m3_eavg_boot_ci  &lt;- calc_ci(&quot;Eavg&quot;,    boot_vals_m3, 2)
  
# m4
  m4_c_boot_ci     &lt;- calc_ci(&quot;C (ROC)&quot;, boot_vals_m4, 2)
  m4_brier_boot_ci &lt;- calc_ci(&quot;Brier&quot;,   boot_vals_m4, 2)
  m4_emax_boot_ci  &lt;- calc_ci(&quot;Emax&quot;,    boot_vals_m4, 2)
  m4_eavg_boot_ci  &lt;- calc_ci(&quot;Eavg&quot;,    boot_vals_m4, 2)</code></pre>
<p>This code is for the shrinkage corrected c-index and calibration slope for Model Revision. Since we are estimating new coefficients for each predictor from the data we have, this helps us avoid over-fit. To do this, we use <code>rms::validate</code>.</p>
<pre class="r"><code># To use validate, we need to estimate m4 with lrm instead of glm. 

  d &lt;- datadist(data)
  options(datadist = &quot;d&quot;)
  
  m4b &lt;- lrm(formula_4, data = data2, x = TRUE, y = TRUE)

  set.seed(04012019)
  val_new &lt;- rms::validate(m4b, B = 500)
  
  shrink_factor &lt;- round(val_new[&quot;Slope&quot;,&quot;index.corrected&quot;], 2)
  c_corrected &lt;- round(0.5 * (1 + val_new[&quot;Dxy&quot;,&quot;index.corrected&quot;]), 2)</code></pre>
<p>Finally, this is the code for making the calibration plots (<code>rms::val.plot</code> will also give a nice calibration plot unless it’s suppressed in the call, but I wanted a ggplot based version so I could tweak it to my liking).</p>
<pre class="r"><code># Function to produce the calibration plots

  cal_plot &lt;- function(model, model_name, pred_var, ...){

    require(tidyverse)
    require(viridis)
    require(gridExtra)

# The calibration plot        
    g1 &lt;- mutate(data, bin = ntile(get(pred_var), 10)) %&gt;% 
          # Bin prediction into 10ths
      group_by(bin) %&gt;%
      mutate(n = n(), # Get ests and CIs
             bin_pred = mean(get(pred_var)), 
             bin_prob = mean(as.numeric(alive) - 1), 
             se = sqrt((bin_prob * (1 - bin_prob)) / n), 
             ul = bin_prob + 1.96 * se, 
             ll = bin_prob - 1.96 * se) %&gt;%
      ungroup() %&gt;%
    ggplot(aes(x = bin_pred, y = bin_prob, ymin = ll, ymax = ul)) +
      geom_pointrange(size = 0.5, color = &quot;black&quot;) +
      scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.1)) +
      scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.1)) +
      geom_abline() + # 45 degree line indicating perfect calibration
      geom_smooth(method = &quot;lm&quot;, se = FALSE, linetype = &quot;dashed&quot;, 
                  color = &quot;black&quot;, formula = y~-1 + x) + 
                  # straight line fit through estimates
      geom_smooth(aes(x = get(pred_var), y = as.numeric(alive) - 1), 
                  color = &quot;red&quot;, se = FALSE, method = &quot;loess&quot;) + 
                  # loess fit through estimates
      xlab(&quot;&quot;) +
      ylab(&quot;Observed Probability&quot;) +
      theme_minimal() +
      ggtitle(model_name)

# The distribution plot        
    g2 &lt;- ggplot(data, aes(x = get(pred_var))) +
      geom_histogram(fill = &quot;black&quot;, bins = 200) +
      scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.1)) +
      xlab(&quot;Predicted Probability&quot;) +
      ylab(&quot;&quot;) +
      theme_minimal() +
      scale_y_continuous(breaks = c(0, 40)) +
      theme(panel.grid.minor = element_blank())
    
# Combine them    
    g &lt;- arrangeGrob(g1, g2, respect = TRUE, heights = c(1, 0.25), ncol = 1)
    grid.newpage()
    grid.draw(g)
    return(g[[3]])

  }</code></pre>
</div>
<div id="results" class="section level2">
<h2>Results</h2>
<pre class="r"><code># Combine all the results into a single dataframe 

  model_tab_1 &lt;- data_frame(
    est = c(&quot;Intercept&quot;, &quot;Slope&quot;, &quot;Residual deviance&quot;, &quot;Df&quot;, 
            &quot;LRT Chisq p-value&quot;, &quot;Brier score (rescaled)&quot;,
            &quot;Emax&quot;, &quot;Eavg&quot;, &quot;c-statistic&quot;),
    m1_est = c(round(c(0, 1,                 m1$deviance, m1$df.residual, 0), 2), 
               paste(b1, m1_brier_boot_ci), 
               paste(val_m1[&quot;Emax&quot;], m1_emax_boot_ci),
               paste(val_m1[&quot;Eavg&quot;], m1_eavg_boot_ci),
               paste(round(val_m1[&quot;C (ROC)&quot;], 2), m1_c_boot_ci)),
    m2_est = c(round(c(tidy(m2)$estimate, 1, m2$deviance, m2$df.residual, 0), 2), 
               paste(b2, m2_brier_boot_ci), 
               paste(val_m2[&quot;Emax&quot;], m2_emax_boot_ci),
               paste(val_m2[&quot;Eavg&quot;], m2_eavg_boot_ci), 
               paste(round(val_m2[&quot;C (ROC)&quot;], 2), m2_c_boot_ci)),
    m3_est = c(round(c(tidy(m3)$estimate,    m3$deviance, m3$df.residual, 0), 2), 
               paste(b3, m3_brier_boot_ci), 
               paste(val_m3[&quot;Emax&quot;], m3_emax_boot_ci),
               paste(val_m3[&quot;Eavg&quot;], m3_eavg_boot_ci),
               paste(round(val_m3[&quot;C (ROC)&quot;], 2), m3_c_boot_ci)),
    m4_est = c(&quot;&quot;, &quot;&quot;,               round(c(m4$deviance, m4$df.residual, 0), 2), 
               paste(b4, m4_brier_boot_ci), 
               paste(val_m4[&quot;Emax&quot;], m4_emax_boot_ci),
               paste(val_m4[&quot;Eavg&quot;], m4_eavg_boot_ci),
               paste(round(val_m4[&quot;C (ROC)&quot;], 2), m4_c_boot_ci))
    )
  
  names(model_tab_1) &lt;- c(&quot;&quot;, &quot;HOMR model&quot;, &quot;Calibration in the Large&quot;, 
                          &quot;Logistic Recalibration&quot;, &quot;Model Revision&quot;)
  
  model_tab_1[5, 2:5] &lt;- c(
    &quot;-&quot;, &quot;&lt;0.001&quot;, round(anova(m2, m3, test = &quot;Chisq&quot;)[5][2, ], 2), &quot;-&quot;
    )</code></pre>
<p><strong>Table 1.</strong> All the results hacked into a table.</p>
<pre class="r"><code>  knitr::kable(model_tab_1)</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="left">HOMR model</th>
<th align="left">Calibration in the Large</th>
<th align="left">Logistic Recalibration</th>
<th align="left">Model Revision</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Intercept</td>
<td align="left">0</td>
<td align="left">-0.42</td>
<td align="left">-0.43</td>
<td align="left"></td>
</tr>
<tr class="even">
<td>Slope</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0.99</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td>Residual deviance</td>
<td align="left">1139.96</td>
<td align="left">1107.76</td>
<td align="left">1107.73</td>
<td align="left">1046.55</td>
</tr>
<tr class="even">
<td>Df</td>
<td align="left">1409</td>
<td align="left">1408</td>
<td align="left">1407</td>
<td align="left">1389</td>
</tr>
<tr class="odd">
<td>LRT Chisq p-value</td>
<td align="left">-</td>
<td align="left">&lt;0.001</td>
<td align="left">0.85</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td>Brier score (rescaled)</td>
<td align="left">0.15 (0.09 to 0.22)</td>
<td align="left">0.19 (0.11 to 0.26)</td>
<td align="left">0.19 (0.11 to 0.27)</td>
<td align="left">0.23 (0.17 to 0.32)</td>
</tr>
<tr class="odd">
<td>Emax</td>
<td align="left">0.103 (0.08 to 0.17)</td>
<td align="left">0.111 (0.03 to 0.25)</td>
<td align="left">0.121 (0.03 to 0.23)</td>
<td align="left">0.017 (0.01 to 0.11)</td>
</tr>
<tr class="even">
<td>Eavg</td>
<td align="left">0.058 (0.04 to 0.08)</td>
<td align="left">0.016 (0.01 to 0.03)</td>
<td align="left">0.017 (0.01 to 0.03)</td>
<td align="left">0.008 (0 to 0.02)</td>
</tr>
<tr class="odd">
<td>c-statistic</td>
<td align="left">0.78 (0.75 to 0.81)</td>
<td align="left">0.78 (0.75 to 0.81)</td>
<td align="left">0.78 (0.75 to 0.81)</td>
<td align="left">0.82 (0.8 to 0.86)</td>
</tr>
</tbody>
</table>
</div>
<div id="calibration-plots" class="section level2">
<h2>Calibration plots</h2>
<p><strong>Figure 2.</strong> Calibration plot for the HOMR model in a sample of 1409 patients aged 65 years or older that were under the care of geriatric medicine service at Cork University Hospital (2013-01-01 to 2015-03-06)</p>
<pre class="r"><code>  x &lt;- cal_plot(m1, &quot;HOMR model&quot;, &quot;m1_pred&quot;)</code></pre>
<p><img src="/post/homr_files/figure-html/figure_1-1.svg" width="768" /></p>
<p><strong>Figure 3.</strong> Calibration plot for <strong>Recalibration in the Large</strong> <img src="/post/homr_files/figure-html/figure_2-1.svg" width="768" /></p>
<p><strong>Figure 4.</strong> Calibration plot for <strong>Model Revision</strong> <img src="/post/homr_files/figure-html/figure_3-1.svg" width="768" /></p>
</div>
<div id="other-stuff" class="section level2">
<h2>Other stuff</h2>
<p><strong>Figure 5.</strong> Logistic curve fit of the original HOMR model to one year post-hospitalization mortality</p>
<pre class="r"><code># Plot of data with a logistic curve fit
  ggplot(data, aes(x = z_homr, y = as.numeric(alive) - 1)) +
    geom_jitter(height = 0.1, size =1, alpha = 0.5) +
    geom_smooth(method = &quot;glm&quot;,
                method.args = list(family = &quot;binomial&quot;)) +
    theme_minimal() +
    scale_y_continuous(breaks = c(0, 1), labels = c(&quot;Alive&quot;, &quot;Dead&quot;)) +
    ylab(&quot;&quot;) +
    xlab(&quot;HOMR Linear Predictor&quot;)</code></pre>
<p><img src="/post/homr_files/figure-html/unnamed-chunk-1-1.svg" width="768" /></p>
<p><strong>Figure 6.</strong> Number/Proportion of patients who died within one year of hospitalization by risk level (Z)</p>
<pre class="r"><code>  g1 &lt;- ggplot(data, aes(x = z_homr, fill = alive)) +
    geom_histogram() +
    theme_minimal() +
    xlab(&quot;HOMR Linear Predictor&quot;) +
    ylab(&quot;Number of Participants&quot;) +
    scale_fill_brewer(&quot;Alive&quot;, palette = &quot;Paired&quot;)

  g2 &lt;- ggplot(data, aes(x = z_homr, fill = alive)) +
    geom_histogram(position = &quot;fill&quot;) +
    theme_minimal() +
    xlab(&quot;HOMR Linear Predictor&quot;) +
    ylab(&quot;Proportion&quot;) +
    scale_fill_brewer(&quot;Alive&quot;, palette = &quot;Paired&quot;)
  
  grid.arrange(g1, g2, ncol = 1)</code></pre>
<p><img src="/post/homr_files/figure-html/unnamed-chunk-2-1.svg" width="768" /></p>
<p><strong>Figure 7.</strong> Distribution of the original HOMR linear predictor among those who did and didn’t die within one year after hospitalization</p>
<pre class="r"><code>  ggplot(data, aes(y = z_homr, x = alive, fill = alive, color = alive)) +
    geom_beeswarm() +
    geom_boxplot(alpha = 0, color = &quot;black&quot;) +
    theme_minimal() +
    ylab(&quot;HOMR Linear Predictor&quot;) +
    xlab(&quot;Alive at 1 year&quot;) +
    scale_fill_brewer(guide = FALSE, palette = &quot;Paired&quot;) +
    scale_color_brewer(guide = FALSE, palette = &quot;Paired&quot;) </code></pre>
<p><img src="/post/homr_files/figure-html/unnamed-chunk-3-1.svg" width="768" /></p>
<p><strong>Table 2.</strong> HOMR Model Revision coefficients</p>
<pre class="r"><code>  covariates &lt;- c(
    &quot;Intercept&quot;,
    &quot;DRS&quot;,                                            
    &quot;sqrt(Age)&quot;,                                            
    &quot;Male (vs Female)&quot;,                                       
    &quot;Rehab&quot;,                             
    &quot;Homecare&quot;,                         
    &quot;Nursing Home&quot;,                     
    &quot;log(CCI)&quot;,                                            
    &quot;sqrt(Ed visits in the previous year + 1)&quot;,                                
    &quot;1/(Admissions by ambulance in previous year +1)&quot;,    
    &quot;Other (vs General Medicine)&quot;,                        
    &quot;ED w/o Ambulance&quot;,                 
    &quot;ED w/Ambulance&quot;,                   
    &quot;Urgent readmission&quot;,                             
    &quot;Sqrt(Age) * log(CCI)&quot;,                                       
    &quot;Rehab * 1/(Admissions by ambulance in previous year +1)&quot;,              
    &quot;Homecare * 1/(Admissions by ambulance in previous year +1)&quot;,           
    &quot;Nursing Home * 1/(Admissions by ambulance in previous year +1)&quot;,       
    &quot;ED w/o Ambulance * 1/(Admissions by ambulance in previous year +1)&quot;,
    &quot;ED w/Ambulance * 1/(Admissions by ambulance in previous year +1)&quot;
  )

  sjPlot::tab_model(m4, show.p = FALSE, show.ci = FALSE, show.se = TRUE, 
                    transform = NULL, pred.labels = covariates)</code></pre>
<table style="border-collapse:collapse; border:none;">
<tr>
<th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; ">
 
</th>
<th colspan="2" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">
alive
</th>
</tr>
<tr>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; ">
Predictors
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
Log-Odds
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
std. Error
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Intercept
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-14.84
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
4.02
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
DRS
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.11
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.02
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
sqrt(Age)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.45
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.43
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Male (vs Female)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.44
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.17
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Rehab
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-1.16
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.71
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Homecare
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.41
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.66
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Nursing Home
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-0.34
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.29
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
log(CCI)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
2.78
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
2.83
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
sqrt(Ed visits in the previous year + 1)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.16
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.71
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
1/(Admissions by ambulance in previous year +1)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.19
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.61
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Other (vs General Medicine)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-0.68
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.46
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
ED w/o Ambulance
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.38
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.67
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
ED w/Ambulance
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.21
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.12
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Urgent readmission
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.60
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.27
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Sqrt(Age) * log(CCI)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-0.23
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.31
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Rehab * 1/(Admissions by ambulance in previous year +1)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-0.31
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.79
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Homecare * 1/(Admissions by ambulance in previous year +1)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-0.51
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.82
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Nursing Home * 1/(Admissions by ambulance in previous year +1)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-0.46
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.78
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
ED w/o Ambulance * 1/(Admissions by ambulance in previous year +1)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-0.87
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.76
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
ED w/Ambulance * 1/(Admissions by ambulance in previous year +1)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
-1.91
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.34
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;">
Observations
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="2">
1409
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
Cox &amp; Snell’s R<sup>2</sup> / Nagelkerke’s R<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="2">
0.191 / 0.310
</td>
</tr>
</table>
<p>Note: Admit service recoded to General Medicine vs Other, due to small call sizes. ICU admission was omitted as there were only 3 cases of this happening. Home O2 was omitted since no patients in our sample were using it.</p>
<p>Full distributions of bootstrapped values.</p>
<pre class="r"><code>  boots &lt;- function(metric, boot_vals){
    x &lt;- as.numeric(unlist(map(boot_vals, `[`, metric)))
    if(metric == &#39;Brier&#39;){x &lt;- as.numeric(rescale_brier(x, 0.184))}
    return(x)
  }

  boot_list &lt;- list(boot_vals_m1, boot_vals_m2, boot_vals_m3, boot_vals_m4)
  metrics &lt;- c(&quot;C (ROC)&quot;, &quot;Brier&quot;, &quot;Eavg&quot;, &quot;Emax&quot;)
  
  x &lt;- c()
  for(i in metrics){
    for(j in 1:4){
      x &lt;- c(x, boots(i, boot_list[[j]]))
    }
  }
  
  y &lt;- rep(c(paste0(&quot;m&quot;, 1:4, &quot; c-index&quot;), paste0(&quot;m&quot;, 1:4, &quot; Brier&quot;), 
             paste0(&quot;m&quot;, 1:4, &quot; Emax&quot;), paste0(&quot;m&quot;, 1:4, &quot; Eavg&quot;)), 
           each = 500) 

  boot_data &lt;- data_frame(var = y, val = x)</code></pre>
<p><strong>Figure 7.</strong> Distributions of bootstrapped model statistics</p>
<pre class="r"><code>  ggplot(boot_data, aes(x = val)) +
    geom_density() +
    facet_wrap(~var, nrow = 4, scales = &quot;free&quot;) +
    theme_minimal() +
    xlab(&quot;&quot;) +
    ylab(&quot;Density&quot;)</code></pre>
<p><img src="/post/homr_files/figure-html/boot_plot-1.svg" width="768" /></p>
<pre class="r"><code># Packages used

# library(tidyverse)
# library(rms)
# library(Hmisc)
# library(knitr)
# library(broom)
# library(pander)
# library(ggbeeswarm)
# library(gridExtra)
# library(grid)
# library(sjPlot)
# library(sjmisc)
# library(sjlabelled)
# library(viridis)

  sessionInfo()</code></pre>
<pre><code>## R version 3.4.3 (2017-11-30)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 15063)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_United Kingdom.1252 
## [2] LC_CTYPE=English_United Kingdom.1252   
## [3] LC_MONETARY=English_United Kingdom.1252
## [4] LC_NUMERIC=C                           
## [5] LC_TIME=English_United Kingdom.1252    
## 
## attached base packages:
## [1] grid      methods   stats     graphics  grDevices utils     datasets 
## [8] base     
## 
## other attached packages:
##  [1] viridis_0.5.1     viridisLite_0.3.0 sjlabelled_1.0.17
##  [4] sjmisc_2.7.9      sjPlot_2.6.2      gridExtra_2.3    
##  [7] ggbeeswarm_0.6.0  pander_0.6.2      broom_0.4.4      
## [10] knitr_1.20        rms_5.1-2         SparseM_1.77     
## [13] Hmisc_4.1-1       Formula_1.2-3     survival_2.41-3  
## [16] lattice_0.20-35   forcats_0.3.0     stringr_1.3.1    
## [19] dplyr_0.8.0.1     purrr_0.2.5       readr_1.1.1      
## [22] tidyr_0.8.1       tibble_2.0.1      ggplot2_3.1.0    
## [25] tidyverse_1.2.1  
## 
## loaded via a namespace (and not attached):
##  [1] nlme_3.1-131        lubridate_1.7.4     insight_0.2.0      
##  [4] RColorBrewer_1.1-2  httr_1.4.0          rprojroot_1.3-2    
##  [7] TMB_1.7.13          tools_3.4.3         backports_1.1.2    
## [10] R6_2.2.2            rpart_4.1-11        vipor_0.4.5        
## [13] lazyeval_0.2.1      colorspace_1.3-2    nnet_7.3-12        
## [16] withr_2.1.2         tidyselect_0.2.5    mnormt_1.5-5       
## [19] emmeans_1.2.3       curl_3.3            compiler_3.4.3     
## [22] cli_1.0.1           rvest_0.3.2         quantreg_5.36      
## [25] htmlTable_1.12      xml2_1.2.0          sandwich_2.4-0     
## [28] labeling_0.3        bookdown_0.9        scales_1.0.0       
## [31] checkmate_1.8.5     polspline_1.1.13    mvtnorm_1.0-8      
## [34] psych_1.8.4         digest_0.6.18       minqa_1.2.4        
## [37] foreign_0.8-69      rmarkdown_1.10      base64enc_0.1-3    
## [40] pkgconfig_2.0.2     htmltools_0.3.6     lme4_1.1-17        
## [43] highr_0.7           htmlwidgets_1.3     rlang_0.3.4        
## [46] readxl_1.1.0        rstudioapi_0.7      zoo_1.8-2          
## [49] jsonlite_1.6        acepack_1.4.1       magrittr_1.5       
## [52] Matrix_1.2-12       Rcpp_1.0.0          munsell_0.5.0      
## [55] stringi_1.4.3       multcomp_1.4-8      yaml_2.1.19        
## [58] snakecase_0.9.1     MASS_7.3-47         plyr_1.8.4         
## [61] parallel_3.4.3      crayon_1.3.4        ggeffects_0.9.0    
## [64] haven_2.1.0         splines_3.4.3       sjstats_0.17.4     
## [67] hms_0.4.2           pillar_1.3.1        estimability_1.3   
## [70] reshape2_1.4.3      codetools_0.2-15    glue_1.3.0         
## [73] evaluate_0.10.1     blogdown_0.6        latticeExtra_0.6-28
## [76] data.table_1.11.4   modelr_0.1.2        nloptr_1.0.4       
## [79] MatrixModels_0.4-1  cellranger_1.1.0    gtable_0.2.0       
## [82] assertthat_0.2.0    xfun_0.2            xtable_1.8-2       
## [85] coda_0.19-1         glmmTMB_0.2.1.0     beeswarm_0.2.3     
## [88] cluster_2.0.6       TH.data_1.0-8</code></pre>
</div>

					</div>
				</article>
                
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
							<span class="posted-on"><time class="entry-date published" date="2018-11-14 12:00:00 &#43;0000 UTC">November 14, 2018</time></span>
						</div>
						<h1 class="entry-title"><a href="/post/trial_methods_wk_1/" rel="bookmark">Trial Methods Week 1 - Reading Notes (Draft 1.0)</a></h1>
					</header>
					<div class="entry-content">
						

<h2 id="week-1-introduction">Week 1 - Introduction</h2>

<p>The goals of week 1 are to:</p>

<ol>
<li>Welcome everyone and introduce the module</li>
<li>Explain the role of the statistician and their role on the trial team</li>
<li>Motivate an interest in proper clinical trial design and analysis</li>
<li>Introduce the most fundamental aspects of trial design, and justify the importance of control and randomization.</li>
</ol>

<h3 id="welcome">Welcome</h3>

<p>I want to welcome you all to this module on <strong>Clinical Trial Design and Analysis</strong>.</p>

<p>You have already learned about all the important people it takes to run a clinical trial.  These include research nurses, pharmacists, data managers, information technologists, programmers, research assistants, monitors, regulatory experts, statisticians, clinical investigators, and of course the patients themselves.  Some of you taking this module are <strong>Clinical Investigators</strong>, and will be responsible for the medical care of patients enrolled in the study, the overall project management of the trial, and the scientific content of the study. This is a lot for any one person to contend with, so it is critical that you can count on the support from the other experts in the study team.</p>

<p>When it comes to meeting the <strong>scientific</strong> goals of the trial, this support will primarily come from the <strong>Trial Statistician</strong>. Importantly, the clinical investigator and the trial statistician will each bring <strong>different but vital</strong> knowledge to bear on the trial’s design. The clinical investigator will be the subject-matter expert, knowledgeable about clinical problem at hand, and the potential solution being evaluated in the trial. The statistician’s expertise, on the other hand, is ultimately about how to draw appropriate <strong>inferences</strong> from the results of a given trial, and how to design trials that best support these efforts. Another way to view this distinction is that the clinical investigator is an expert on what we know, while statisticians focus on understanding how we come to know things.</p>

<p>There is no doubt that good clinical investigators will, over time, acquire some of the statistician’s expertise, just as any respectable statistician will eventually become quite knowledgeable about the clinical areas they work in. However, a tenet of this module is that the role of the Trial Statistician should be respected as a <strong>unique</strong> contribution that is <strong>necessary</strong> for the successful conduct of a clinical trial.  Consequently, this module is not designed to teach you how to “be a statistician”, but rather how to work with a statistician to support optimal trial design .</p>

<h3 id="why-good-design-and-analysis-matters">Why good design and analysis matters</h3>

<p>Perhaps it is obvious to <em>you</em> why good trial design and analysis matters. There is a wealth of evidence however that clinical trials are often flawed in their design; and that errors in the analysis and reporting of trial data are common.</p>

<p>The problems are not inconsequential. In 1994, the late Doug Altman, writing in the BMJ, talked about <a href="https://www.bmj.com/content/308/6924/283">“the scandal of poor medical research.”</a></p>

<blockquote>
<p>What should we think about a doctor who uses the wrong treatment, either wilfully or through ignorance, or who uses the right treatment wrongly (such as by giving the wrong dose of a drug)? Most people would agree that such behaviour was unprofessional, arguably unethical, and certainly unacceptable.
What, then, should we think about researchers who use the wrong techniques (either wilfully or in ignorance), use the right techniques wrongly, misinterpret their results, report their results selectively, cite the literature selectively, and draw unjustified conclusions? We should be appalled. Yet numerous studies of the medical literature, in both general and specialist journals, have shown that all of the above phenomena are common. This is surely a scandal.</p>
</blockquote>

<p>One might hope that much has changed since Altman wrote these words, but in 2009, <a href="https://www.thelancet.com/journals/lancet/article/PIIS0140-6736(09)60329-9/abstract">Chalmers and Glasziou</a> made the provocative claim that perhaps as much as 85% of research funding in the biomedical sciences was wasted. This claim was followed up in <a href="https://www.thelancet.com/series/research">a special issue on “research waste” in the Lancet five years later</a>. The reasons for research waste included a number of issues we will touch on to varying degrees in this modules. These were inappropriate or irrelevant research questions; biased or inaccessible reports of research results; and most importantly, from our perspective, errors in study design and data analysis.</p>

<p>Around the time that research waste was capturing our attention, Ioannidis published his landmark 2005 paper in PLOS ONE, titled <a href="http://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.0020124">“Why most research findings are false.”</a>  While Chalmers, Glaziou and others were discussing a relatively broad set of problems, Ioannidis observations were more focused more on statistics and epistemology. In a nutshell, he argued that many research findings were likely to be so-called false positives, and outlined the circumstances that would most often lead to this. While Ioannidis’s position has been challenged (<a href="https://blogs.plos.org/absolutely-maybe/2013/12/16/biomedical-research-believe-it-or-not/">see here</a>), it helped promote the importance of meta-research (research about research) aimed at improving the methodological issues we are discussing.</p>

<p>Ioannidis’s paper also coincided with increasing recognition of the <a href="https://www.nature.com/articles/s41562-016-0021">modern reproducibility crisis</a>. Largely starting in psychology, but since extending to other fields, researchers started to pay more attention to replicating earlier studies. Many were surprised to find that studies often failed to replicate, even very famous ones. This led researchers to think more deeply about these reasons for this, which subsequently drew more attention to so-called questionable research practices, such as p-hacking (the process of modifying a statistical analysis, often with good intentions, until an acceptable result is found).</p>

<p>During this tumultuous period (which is ongoing), one particular statistical tool, the ubiquitous p-value, started to draw some of the blame for many of these problems. As we will learn next week, statisticians have been arguing about the value of p-values, or lack thereof, since the moment they were invented by Sir Ronald Fisher. However, this questioning of p-values among the wider community of scientists was notable, leading the American Statistical Association to commission an expert panel to weigh in. This resulted in a <a href="https://amstat.tandfonline.com/doi/abs/10.1080/00031305.2016.1154108">position paper from the ASA</a> attempting to clarify how p-values should and shouldn’t be used. Of course, in the great tradition of statisticians, the position paper has hardly settled matters, and arguments over p-values continue (e.g. <a href="https://www.nature.com/articles/s41562-017-0189-z">“Redefining Statistical Significance”</a> vs <a href="https://www.nature.com/articles/s41562-018-0311-x">“Justify Your Alpha”</a>).</p>

<h3 id="the-researcher-as-statistician">The Researcher as Statistician</h3>

<p>So where does all of this leave us with respect to this module on clinical trial design and analysis? In our opinion, many of the problems we just described are substantially driven by a lack of expert statistical input in many, if not most, studies.  This includes both the design of studies before they are conducted, and the analysis of the resulting data. Unfortunately, there aren’t enough experienced statisticians in the world to contribute to every study, so scientists are often expected to act as their own statistician (or similarly nominate someone they are working with).  Thus most of us receive at least some statistical training, though it is typically limited in the following ways:</p>

<ul>
<li>It typically centres on a statistical toolkit from which researchers select the appropriate test or procedure based on the characteristics the data they are using. While this tool kit is often sufficient for the analysis of well-conducted, relatively simple experiments, it completely lacks tools needed for common statistical challenges that occur in the wild, such as missing data, clustered observations, preventing overfit, measurement error, and model selection.</li>
<li>The rationale for different statistical methods are often left unexplored, leaving students ill-equipped to apply them critically.</li>
<li>There is little training, if any, in data management, manipulation, or visualization.</li>
<li>Statistics is typically presented as something you do to data once they are collected, so that important links between study design and statistical methods are obscured.</li>
<li>Because almost all scientists receive some training in statistics, the mathematical underpinnings are often omitted or glossed over to accommodate the wide range of learners’ previous maths training and quantitative aptitude.</li>
<li>Students are frequently left with the impression that statistics is a monolith, firmly rooted in mathematics and thus somehow pure - while in truth the subject is highly contentious and as closely aligned to philosophy as it is to maths.</li>
</ul>

<p>A troubling consequence of all of this is that too many statistical analyses are conducted by researchers who readily admit that they don’t feel comfortable with statistics (or even dislike them), or by researchers who don’t understand the limits of their own statistical knowledge. Further, because many senior scientists aren’t any more comfortable with statistics than their less experienced colleagues, the task of analysing the data often falls on the latter. These problems, in our experience, can be exacerbated in clinical trials. This is because most clinical investigators receive even less training in study design and statistics than the scientists leading research in other fields. This of course no fault of their own – they are busy learning all of the critically important things they need to be good clinicians! This module then is partly aimed at catching everyone up, so to speak, while redressing some of the limitations of typical statistical training listed above - but perhaps more importanly, about teaching you how to work with a trial statistican.</p>

<h3 id="randomized-controlled-trials-an-overview">Randomized controlled trials: An Overview</h3>

<p>The randomized controlled trial (RCT) is widely recognized as the preferred study design for understanding the effects of an intervention. However, to reap the benefits of an RCT, it must be <strong>well-designed</strong> and <strong>properly conducted</strong>. This module is primarily focused on ensuring the former. RCT designs include several components, and choices regarding these components are deeply interrelated. It will thus be helpful to now take a big picture view of what these key components are.</p>

<p>The first thing any trial needs is <strong>patients</strong>. This fact underpins critically important ethical considerations, as well as many practical aspects of trial conduct. Special care will be taken to define exactly which kinds of patients to include in the trial.</p>

<p>The next thing a trial needs is an <strong>intervention</strong> we would like to test. Common examples include medicines, devices, and educational programs. For any proposed intervention, we will need to carefully consider <strong>equipoise</strong>, and how the nature of the intervention may impact the trial’s design.</p>

<p>The final critical component to a trial is the <strong>outcome</strong> (or <strong>endpoint</strong>), which is something about the patients we can measure to facilitate judgement of the intervention. In other words, it is almost always the thing about the patients that the intervention is meant to improve. Examples would be blood pressure, weight, quality of life, and time to death.</p>

<p>While one can technically run a <strong>trial</strong> with just the above three components, it’s really the next two components that really increase its evidential value. These are the use of a <strong>control</strong> arm, and using <strong>randomization</strong> to allocate patients to the different study arms.</p>

<h3 id="concurrent-controls">Concurrent Controls</h3>

<p>There is a famous story of a psychologist who went to work with the Israeli Air Force to help them improve the performance of their pilots (<a href="https://en.wikipedia.org/wiki/Thinking,_Fast_and_Slow">ref</a>). The psychologist talked about the value of positive reinforcement - but an experienced trainer questioned this, pointing out that when they praised pilots after they did well on an exercise, they almost always did worse the next time out. Conversely, when pilots performed poorly, they were yelled at or punished, and sure enough, their performance would almost always improve.  In other words, the experience of the trainer was completely counter to the psychologist’s advice. So who was right?</p>

<p>If you think it was the trainers, then you’ve just fallen victim to one of the most pervasive challenges in data analysis, called regression to the mean. In a nutshell, regression to the mean is when we select a group based on having relatively extreme values for some variable (e.g. take all the pilots that did very well on an exercise), measure that variable again, and see that the second set of measurements aren’t as extreme, on average, as the first set.  To better understand this phenomena, please watch the following video, which uses an example from SIDD.</p>

<p>[rtm.video]()</p>

<p><a href="https://darrendahly.shinyapps.io/rtm_app/">rtm.app</a></p>

<h3 id="randomization">Randomization</h3>

<p>Randomization refers to a set of tools used to allocate study participants to different treatments based on chance alone. R.A. Fisher is widely credited with first employing randomization in experimental research, when he used chance to assign treatments to different plots of land in agricultural experiments (Fisher RA. The Design of Experiments, 7th ed. Edinburgh: Oliver and Boyd, 1971).  For Fisher, randomization was fundamental to the tests of significance he advocated, by supporting the assumptions about normal error distributions, and facilitating permutation tests when parametric assumptions were untenable (<a href="http://ije.oxfordjournals.org/content/32/6/925.long">REF</a>). We will discuss this further in the lessons on <strong>probability theory</strong> and <strong>statistical inference</strong>.</p>

<p>Bradford Hill is then credited with promoting randomization in the context of clinical trials (<a href="http://www.bmj.com/content/2/4582/769.full.pdf+html">Medical Research Council (MRC). Streptomycin treatment of pulmonary tuberculosis: A Medical Research Council investigation. Br Med J 2:769-782, 1948</a>). Though a statistician, Hill’s focus on randomization was less about the statistical properties, but was more about his desire to allocate patients to treatments in an unbiased manner – to avoid “personal idiosyncrasies”, “personal judgement”, and importantly, to protect oneself from critics who might say that our treatment groups are different due to <a href="http://bmb.oxfordjournals.org/content/7/4/278.full.pdf+html">“our predilections or through our stupidity.”</a> In other words, Hill saw randomization as our best tool for maintaining <strong>allocation concealment</strong>, and thus improving <strong>causal inferences</strong>. The importance of allocation concealment in experiments was recognized much earlier than randomization per se, and researchers were already using methods such as alternation (see the <a href="http://www.jameslindlibrary.org/essays/2-2-the-need-to-compare-like-with-like-in-treatment-comparisons/">James Lind Library</a> for an interesting, comprehensive overview). Hill understood, however, that while these tools might conceal allocation in theory, they were far from fool-proof.  The value of randomization for this purpose is now well recognized. In modern trials, randomization is now required for “utmost good faith”, and any regulator would likely be suspicious of a trial where the investigators chose not to randomize (SIDD p35).</p>

<h3 id="required-reading">Required reading</h3>

<p><a href="http://www.senns.demon.co.uk/SIDD.html">SIDD 2007</a> - Chapter 3</p>

<h3 id="discussion">Discussion</h3>

<p>Topic 1 - Randomization
Workplace Wellness Programs Don’t Work Well. Why Some Studies Show Otherwise.
<a href="https://www.nytimes.com/2018/08/06/upshot/employer-wellness-programs-randomized-trials.html">https://www.nytimes.com/2018/08/06/upshot/employer-wellness-programs-randomized-trials.html</a></p>

<p>Topic 2 – Placebo effects and regression to the mean
The Therapeutic Effect of Intra-articular Normal Saline Injections for Knee Osteoarthritis: A Meta-analysis of Evidence Level 1 Studies
<a href="http://journals.sagepub.com/doi/abs/10.1177/0363546516680607?journalCode=ajsb">http://journals.sagepub.com/doi/abs/10.1177/0363546516680607?journalCode=ajsb</a></p>

<h3 id="additional-reading">Additional reading:</h3>

<p>SIDD – Chapter 5
<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4415704/">Bridging Clinical Investigators and Statisticians: Writing the Statistical Methodology for a Research Proposal</a></p>

<p><a href="https://www.jstor.org/stable/2683811?seq=1#page_scan_tab_contents">The Statistician&rsquo;s Role in Developing a Protocol for a Clinical Trial</a></p>

<p><a href="http://annals.org/aim/article-abstract/2706170/researcher-requests-inappropriate-analysis-reporting-u-s-survey-consulting-biostatisticians">Researcher Requests for Inappropriate Analysis and Reporting: A U.S. Survey of Consulting Biostatisticians</a></p>

					</div>
				</article>
                
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
							<span class="posted-on"><time class="entry-date published" date="2018-10-09 12:00:00 &#43;0000 UTC">October 9, 2018</time></span>
						</div>
						<h1 class="entry-title"><a href="/post/rworkshop/" rel="bookmark">1-day R workshop for experienced users - Oct 30, 2018</a></h1>
					</header>
					<div class="entry-content">
						<p><img src="https://crfcsdau.github.io/images/R_workshop.jpg" alt="" /></p>

<p>Overview:
R is a programming language and free software environment for statistical computing and graphics. User instruction in R is often limited to course specific content, that focuses primarily on statistical operations through the base R package. R functionality extends far beyond this and across research fields. When combined with the RStudio GUI, R can be utilised as a powerful tool that encompasses data cleaning, exploration, visualisation and documentation operations.</p>

<p>The dual aim of this 1-day workshop is to (A) highlight how the reorganisation of popular R packages, under the umbrella banner of the “tidyverse”, has made the versatility of R more accessible and (B) introduce data analysis through RStudio project workflows.</p>

<p>Preliminary schedule:</p>

<ul>
<li>9.30 am: Setup, introductions, housekeeping</li>
<li>10 am: Lecture - Introduction to the tidyverse</li>
<li>11 am: Coffee break – Discussion</li>
<li>11.30 am: 3 × 30 minute tidyverse tutorials including:

<ul>
<li>Example scripts and problem sheets exploring R packages tidyr, dplyr, ggplot2 etc.</li>
<li>Opportunity to work on your own data sets</li>
<li>Opportunity to work in groups</li>
</ul></li>
<li>1 pm: Lunch break</li>
<li>2 pm: Lecture - Project orientated workflows through RStudio</li>
<li>3 pm: 3 × 30 minute tutorials dedicated to reproducible research including:

<ul>
<li>Project folder structure</li>
<li>Scripting guides and formats</li>
<li>Automated report generation using RMarkdown</li>
</ul></li>
<li>4.30 pm: Closing remarks</li>
</ul>

<p>Essential Requirements:</p>

<ol>
<li>Experience using R and RStudio</li>
<li>Your own laptop</li>
<li>R and RStudio pre-installed and running</li>
<li>Access to the Eduroam Wi-Fi network</li>
</ol>

<p>Next step:
To register your interest, email b.palmer@ucc.ie. Please ensure “[R Workshop]” appears in the subject line. Your place at the workshop will be confirmed via return email.</p>

<p>And finally:
This workshop will lead-in to a 3-day Open Science event set to run from Wednesday 31st October – Friday 2nd November here in UCC (see attached poster and <a href="https://crfcsdau.github.io/post/openscienceucc/">https://crfcsdau.github.io/post/openscienceucc/</a> for more). Research funders (including H2020, SFI, Wellcome and the HRB) are recognising the long term benefits to Open Science and new grant calls increasingly reflect this. The challenge for researchers is to become aware of the available options, and explore ways in which they can apply these techniques to their own day-to-day research workflows.</p>

					</div>
				</article>
                
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
							<span class="posted-on"><time class="entry-date published" date="2018-08-07 12:00:00 &#43;0000 UTC">August 7, 2018</time></span>
						</div>
						<h1 class="entry-title"><a href="/post/openscienceucc/" rel="bookmark">Open Science @ University College Cork (Oct 31 to Nov 2)</a></h1>
					</header>
					<div class="entry-content">
						<p><strong>Open Science @ UCC</strong> is a 3 day workshop running from October 31 to November 2 (2018) at <a href="https://www.ucc.ie/">University College Cork</a>.</p>

<p>Open science practices help make research accessible, transparent, and replicable.  Research funders (including H2020, SFI and HRB) are recognising the long term benefits to open science and new grant calls increasingly reflect this. The challenge for researchers is to become aware of the available options, and explore ways in which they can apply these techniques to their day-to-day research workflows.</p>

<p>The goal of <strong>Open Science @ UCC</strong> is to bring accomplished experts in open science to <a href="https://www.irishexaminer.com/examviral/cork-voted-third-friendliest-city-in-the-world-861952.html">Cork</a> to train 30 Open Science Champions. The event will be a mixture of lectures, hands-on tutorials, and participant-driven <a href="https://en.wikipedia.org/wiki/Unconference">un-conferencing</a>. There will also be time for discussions, break-out groups, and socializing. Participants will thus leave the workshop as skilled, confident advocates for open science, connected to a network of other open science experts.</p>

<p><strong>Open Science @ UCC</strong> will take place in a multi-purpose learning space called the Creative Zone, located in the main Library on the UCC campus. The topics and confirmed speakers are listed below. We welcome researchers from all stages of their careers. The organizers are dedicated to a harassment-free workshop experience for everyone. Our anti-harassment policy can be found <a href="https://crfcsdau.github.io/post/codeofconduct/">here</a>.</p>

<p><img src="https://crfcsdau.github.io/images/campus.png" alt="" /></p>

<p>To register for the event, please email Dr Darren Dahly (ddahly@ucc.ie). The registration fee is 300 euros per participant for the full three-day event. Payments can be made by invoice or (preferably) credit card (links for payment will be provided upon registration). Full refunds will be available until Monday, October 15, 2018. Given the goals of the workshop, there are no single day options.</p>

<p>The full programme is now available <a href="https://docs.google.com/document/d/1fBazWLomdMO0KgYbu7B3Gsq5Z77L9hWD6XLmc6W15To/edit?usp=sharing">here</a>.</p>

<p><strong>Speakers/Facilitators:</strong></p>

<ul>
<li><a href="http://www.bris.ac.uk/social-community-medicine/people/katherine-s-button/index.html">Dr Kate Button</a> – University of Bristol</li>
<li><a href="https://darrendahly.github.io/">Dr Darren Dahly</a> – University College Cork</li>
<li><a href="https://www.ucc.ie/en/crfc/staff/">Dr Evelyn Flanagan</a> – University College Cork</li>
<li><a href="https://www.ndph.ox.ac.uk/team/verena-heise">Dr Verena Heise</a> – University of Oxford</li>
<li><a href="https://www.linkedin.com/in/victoria-hellon-2294a16b/">Vicky Hellon</a> - F1000 Open Publishing Platforms</li>
<li><a href="https://www.ucc.ie/en/support/library/people/breedaherlihy/">Breeda Herlihy</a> - University College Cork</li>
<li><a href="https://www.gre.ac.uk/people/rep/faculty-of-education-and-health/hannah-hobson">Dr Hannah Hobson</a> – University of Greenwich</li>
<li><a href="https://wellcome.ac.uk/what-we-do/our-work/open-research">Robert Kiley</a> - Wellcome Trust Open Research</li>
<li><a href="https://www.ed.ac.uk/profile/professor-malcolm-macleod">Prof. Malcolm Macleod</a> – University of Edinburgh</li>
<li><a href="http://psych.cf.ac.uk/contactsandpeople/moreyc.php">Dr Candice Morey</a> - Cardiff University</li>
<li><a href="http://psych.cf.ac.uk/contactsandpeople/moreyr.php">Dr Richard Morey</a> – Cardiff University</li>
<li><a href="http://www.bristol.ac.uk/expsych/people/marcus-r-munafo/index.html">Prof. Marcus Munafo</a> – University of Bristol</li>
<li><a href="https://www.ucc.ie/en/support/library/people/eoghanocarragain/">Eoghan O Carragáin</a> – University College Cork</li>
<li><a href="https://crfcsdau.github.io/about/">Dr Brendan Palmer</a> – University College Cork</li>
<li><a href="https://www.rd-alliance.org/about/organization/key-profiles/erik-schultes">Dr Erik Schultes</a> - GO FAIR</li>
<li><a href="https://www.research.manchester.ac.uk/portal/soiland-reyes.html">Stian Soiland-Reyes</a> – University of Manchester</li>
<li><a href="http://research.ucc.ie/profiles/B012/dwhelan">Dr Darius Whelan</a> – University College Cork</li>
</ul>

<p><strong>Open Science Topics we will cover include:</strong></p>

<ul>
<li>FAIR data principles</li>
<li>Git and Github</li>
<li>The Open Science Framework</li>
<li>Copyright and Creative Commons</li>
<li>Reproducible research programming</li>
<li>Research data packaging</li>
<li>Sustainability of open scholarly infrastructure</li>
<li>Open access publishing</li>
<li><a href="https://cos.io/rr/">Registered Reports</a></li>
<li><a href="https://opennessinitiative.org/">The PRO Initiative</a></li>
<li><a href="https://hrbopenresearch.org/">HRB</a>/<a href="https://wellcomeopenresearch.org/">Wellcome Trust</a>/<a href="https://f1000research.com/">F1000 Open Research Platforms</a></li>
<li>Persistent identifiers</li>
<li>Open science for early career researchers</li>
<li>Robust research</li>
</ul>

					</div>
				</article>
                
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
							<span class="posted-on"><time class="entry-date published" date="2018-07-21 12:00:00 &#43;0000 UTC">July 21, 2018</time></span>
						</div>
						<h1 class="entry-title"><a href="/post/negative_results/" rel="bookmark">Dealing with negative trial results</a></h1>
					</header>
					<div class="entry-content">
						<p>Welcome to the world of clinical trials. You&rsquo;ve got a great idea that has real potential to improve health. But I have some bad news for you. Are you ready?</p>

<p>Your intervention won&rsquo;t work. I’m sorry. It won’t. Not even a little.</p>

<p>&ldquo;But hold on a minute,&rdquo; you say. &ldquo;I haven’t even run the trial yet. How can you possibly know it won’t work?&rdquo; Experience my friend – and as any experienced trialist can tell you, the intervention never works. (Ok, sometimes the intervention works, but it usually doesn&rsquo;t, even though we almost always think it will.)</p>

<p>&hellip;</p>

<p>With that in mind, let’s go forward in time. The last follow-up was completed a few weeks ago. Now you are standing next to me, the trial statistician, at the front of a large meeting room in some cookie-cutter hotel. I have a clicker in my hand, there is a graph projected onto the large screen behind us, and I just told everyone that the intervention didn’t work.</p>

<p>Who is everyone? The entire study team of course, all sat quietly at a giant U-shaped table with little name placards in front of them. All the site investigators are there. There is someone from the DMSB too. And of course all the other people it takes to run a trial. Someone from the funding body is there as well - it seems they are interested in what you did with their money. And don’t forget the patients’ representative – they gave more than anyone.</p>

<p>Look at their faces. They look so confused. Disappointed. A few even look sad. Oh no, are those tears? And we were having so much fun up to this point, drinking free coffee and catching up since our last meeting. Now they are just blankly staring at us. You have to say something. You have to say something now.</p>

<p><strong>Freeze time</strong></p>

<p>What are you going to say?</p>

<p>You&rsquo;re new to this, so let me help you. To survive this moment, you need to be able to look everyone in the eye and remind them that the trial was designed to <strong>rigorously answer an important question</strong>. If this is true, then you have likely just learned something useful, regardless of whether the intervention worked or not. Further, if the study was well designed, other people will be more likely to trust your result and act on it. In other words, there is no such thing as a “negative” trial result – the answer given by a well-designed trial is always useful, whether the intervention worked or not. So you simply remind everyone of this. People will still be disappointed of course - we’d be fools to test treatments if we didn’t think they worked, and it&rsquo;s natural to hope. But at least we know we ran a good trial and added knowledge to the world - that&rsquo;s not nothing.</p>

<p>And what if the trial wasn’t well designed? Then the errors in the design might be used to reasonably explain away any result, &ldquo;positive&rdquo; or &ldquo;negative&rdquo;. Maybe the intervention didn&rsquo;t appear to work because the trial was too small. Or maybe it only appeared to work because you used a surrogate outcome. And regardless of the explanations you come up with, nobody else will believe the result anyway, so what&rsquo;s the point? So the best case scenario is that you’ve wasted lots of time and money. The worst case scenario is that you have needlessly put patients at risk. Trust me, there&rsquo;s not enough perfume in France to cover that kind of stink.</p>

<p>So here is my advice. At the start of any trial, imagine yourself in the situation above. The intervention didn’t work. How are you going to live with yourself? Now act accordingly.</p>

					</div>
				</article>
                
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
							<span class="posted-on"><time class="entry-date published" date="2018-05-09 12:00:00 &#43;0000 UTC">May 9, 2018</time></span>
						</div>
						<h1 class="entry-title"><a href="/post/2018-05-09-ocs-wk3/" rel="bookmark">HRB CRFC Open Science Challenge Week 3</a></h1>
					</header>
					<div class="entry-content">
						<p>Thanks again to everyone who came to Week 2 of the Open Science Challenge. If you haven’t made it yet, no worries, you are welcome to join us any time (but if you want me to stop emailing you, let me know).</p>

<p>Our next meeting will be Friday, May 18 at 2-3 pm in WGB room 4.05, where we will have a visit from <a href="https://twitter.com/vickyhellon">Vicky Hellon</a> from <a href="https://f1000.com/">F1000</a> to talk about <a href="https://hrbopenresearch.org/">HRB Open Research</a>.</p>

<p>At our last meeting, we had an excellent discussion of what makes for a good research question. I think the key points from our conversation were as follows:</p>

<ol>
<li>The questions must be scientific, but exactly does this mean? I offered a bit on the <a href="https://en.wikipedia.org/wiki/Problem_of_induction">Problem of Induction, Popper, and Falsification</a>, largely just to establish that smart people can and do disagree on what science is and how it progresses. However, we all seemed to generally agree that science is about asking questions that can be addressed by empirical data.</li>
<li>We discussed the idea of novelty, contrasting false bravado and exaggeration with genuine novelty that drives scientific progress. We also discussed the relative merits of novelty and the importance of replication.</li>
<li>We talked about the importance of our research questions. I mentioned concerns that many research questions, at least in biomedical science, <a href="https://www.thelancet.com/journals/lancet/article/PIIS0140-6736(13)62229-1/fulltext">aren’t the ones that stakeholders and decision makers want answered</a>. I also mentioned the role of initiatives like the <a href="http://www.jla.nihr.ac.uk/about-the-james-lind-alliance/about-psps.htm">JLA Priority Setting Partnerships</a>, as well as funding bodies, in focusing our collective efforts on important questions. We also discussed impact and how the REF in the UK has affected wider perceptions of this term – and thankfully we all agreed that seeing your research in the media isn’t necessarily impact. This conversation dovetailed into shared concerns that basic and methodological research were wrongly placed at disadvantage as the potential value wasn’t as immediately apparent as say an assessment of an intervention – and so we highlighted the need to make the case for the importance of this research, rather than to assume others (reviewers/editors) understand.</li>
<li>We discussed ethics, which turned more towards a discussion of ethics around data collection (rather than scientific questions), so we agreed to pick up this topic again.</li>
<li>We also we able to identify cultural differences across the various fields we each represent.</li>
</ol>

<p>In light of this conversation, we should now be more prepared to devise our own research questions, which we can discuss further on a newly established <a href="https://opensciencechallenge.slack.com/">Slack channel</a>.</p>

					</div>
				</article>
                
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
							<span class="posted-on"><time class="entry-date published" date="2018-04-23 12:00:00 &#43;0000 UTC">April 23, 2018</time></span>
						</div>
						<h1 class="entry-title"><a href="/post/2018-04-23-osc-wk2/" rel="bookmark">HRB CRFC Open Science Challenge - Week 2</a></h1>
					</header>
					<div class="entry-content">
						<p>Thank you to everyone who came to our first session of the HRB Open Science Challenge. If you weren’t able to make it, no problem – we’ll catch you at the next session on May 4th, in room 4.05 of the Western Gateway Building (10:30 to 11:30), when we’ll be discussing what makes a good research question. Please give some thought to that before we meet, as well as what data you might/will use for your project.</p>

<p>During the first meeting we discussed motivations for open science.</p>

<ul>
<li><p>Open Access - Since much of science is publicly funded, it seems reasonable that the public should be able to access the results of said research.</p></li>

<li><p>Reproducibility/Replicability – Single experiments in isolation provide little assurance that an observed effect is “real”. Science thus relies on scientists repeating and then confirming/dis-confirming earlier studies to eventually arrive at a consensus. Sharing research methods and materials is needed to facilitate this process.</p></li>

<li><p>Research Integrity – There is plenty of evidence to suggest that many studies are not conducted properly, especially when it comes to analyses of the resulting data. Mistakes tend to go un-detected because we typically work in isolation and don’t usually fully document our analyses. Further, we can’t really count on peer review to catch mistakes, since we don’t typically share materials with editors/reviewers, and their ability to judge science is highly variable. Thus, the best way (at least in my opinion) to improve the quality of data analyses is to ensure that they are done in a transparent, reproducible manner, which will be a substantial focus of these workshops.</p></li>
</ul>

<p>Lastly we touched on the various tools we’ll cover during the challenge. These include:</p>

<ul>
<li>Statistical programming/scripting</li>
<li>Reproducible reports/literate programming</li>
<li>Software testing</li>
<li>Pre-registration</li>
<li>Registered reports</li>
<li>Pre-prints</li>
<li>Open science publishing platforms</li>
</ul>

					</div>
				</article>
                
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
							<span class="posted-on"><time class="entry-date published" date="2018-04-06 12:00:00 &#43;0000 UTC">April 6, 2018</time></span>
						</div>
						<h1 class="entry-title"><a href="/post/2018-04-06-osc-wk1/" rel="bookmark">HRB CRFC Open Science Challenge</a></h1>
					</header>
					<div class="entry-content">
						<p>I’m a big fan of open science, and regularly argue for its importance. Strangely, however, I’ve never actually used many of the available open science tools. It&rsquo;s just too damn easy to keep going with the status quo. That stops today!</p>

<p>Starting on Friday, April 20, <a href="https://twitter.com/B_A_Palmer">Brendan</a> and I will be hosting the HRB CRFC Open Science challenge. The challenge will be open until the end of the year, during which we will meet 2 or 3 times per month to develop an open science research project. To complete the challenge, participants must meet the following goals before the end of the year:</p>

<ol>
<li>Create a project on the <a href="https://osf.io/">Open Science Framework</a>.</li>
<li><a href="https://cos.io/prereg/">Pre-register</a> the analysis.</li>
<li>Prepare all the analysis code so that it can be shared.<br /></li>
<li>Prepare the data according to <a href="https://www.nature.com/articles/sdata201618">FAIR principles</a>.</li>
<li>Write up the manuscript.</li>
<li>Submit a <a href="https://www.biorxiv.org/">pre-print</a> to the relevant repository</li>
<li>Submit the manuscript to the <a href="https://hrbopenresearch.org/">HRB Open Resaerch Publishing Platform</a> for publication.</li>
</ol>

<p>During the workshops, we will introduce and discuss the various open science tools, as well as talk about how to develop a manuscript in a manner that <a href="https://darrendahly.github.io/post/2017-03-21-prereg/">faciliates pre-registration</a>.</p>

<p>To sign up, please email me your name, position, and affiliation (ddahly@ucc.ie). Anyone is welcome, but a large proportion of places will be reserved for PhD Students and Postdoctoral Researchers working at UCC. Ideally, participants will have some ideas about their research question, and already have access to relevant data. Workshops will rely substantially on small-group discussions - you have been warned.</p>

<p>Meetings will generally take place on Friday mornings in the Western Gateway Building on the UCC campus. The specific schedule will be announced for each month as the rooms are sorted.</p>

					</div>
				</article>
                
				<article class="post">
					<header class="entry-header">
						<div class="entry-meta">
							<span class="posted-on"><time class="entry-date published" date="2018-03-03 00:00:00 &#43;0000 UTC">March 3, 2018</time></span>
						</div>
						<h1 class="entry-title"><a href="/post/cluster/" rel="bookmark">Magical clusters</a></h1>
					</header>
					<div class="entry-content">
						<p>I was greeted today with <a href="http://www.bbc.com/news/health-43246261">the news that there are 5, not 2, types of diabetes</a>. This is <strong>earth-shattering</strong> if you are a diabetologist or diabetes researcher. However, I soon as I saw the term “data-driven clustering” I knew I could probably relax.</p>
<p>For the uninitiated, data-driven clustering techniques can seem magical. The basic premise is that you take a sample, measure lots of things about them, and then feed all those data into an algorithm that will divide your sample into mutually exclusive groups. Then, hopefully, knowing what group a person is in will tell you something about them that isn’t otherwise apparent in the data. This is a seductive idea. In this diabetes example, the authors are touting that knowing a patient’s group will eventually be used to guide their treatment.</p>
<p>I suspect that some people reading about this research won’t understand just how easy it is to detect groups. It’s so easy in fact that I would be shocked if groups <em>weren’t</em> found in most cases. This is because clustering, regardless of the specific method used, is just another way to describe relationships among variables - and as long as the variables are in fact related, you will find groups. Here is a simple example:</p>
<p>First, create some data for two variables. The first is just 1000 observations drawn from a standard normal. The second variable then multiplies the first variable by 2 and adds some additional randomly distributed noise.</p>
<pre class="r"><code>  x &lt;- rnorm(1000, 0, 1)
  y &lt;- (2 * x) + rnorm(1000, 0, 3)

  data &lt;- data.frame(x = x, y = y)</code></pre>
<p>Plotting these data confirms that they are related.</p>
<pre class="r"><code>    plot(x, y, data = data)</code></pre>
<p><img src="/post/cluster_files/figure-html/unnamed-chunk-2-1.svg" width="576" /></p>
<p>Pretending that we didn’t just simulate these data, upon seeing them for the first time, most people would probably try to fit a regression line, the results of which are below.</p>
<pre class="r"><code>  library(pander)

  pander(lm(y ~ x, data))</code></pre>
<table style="width:88%;">
<caption>Fitting linear model: y ~ x</caption>
<colgroup>
<col width="25%" />
<col width="15%" />
<col width="18%" />
<col width="13%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">t value</th>
<th align="center">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">0.07992</td>
<td align="center">0.09135</td>
<td align="center">0.8749</td>
<td align="center">0.3818</td>
</tr>
<tr class="even">
<td align="center"><strong>x</strong></td>
<td align="center">2.023</td>
<td align="center">0.08921</td>
<td align="center">22.68</td>
<td align="center">3.411e-92</td>
</tr>
</tbody>
</table>
<p>So the results of the linear model confirm what we already know. However, there are other ways to explain the data, so to speak. Here are the results from a fairly constrained finite mixture model which is similar enough to the k-means approach used in the diabetes paper.</p>
<pre class="r"><code>  library(mclust)

  bic &lt;- mclustBIC(data)

  clusters &lt;- Mclust(data, x = bic, modelNames = (&quot;EII&quot;))
  
# summary(clusters, parameters = TRUE)</code></pre>
<pre class="r"><code>  plot(clusters, what = &quot;classification&quot;)</code></pre>
<p><img src="/post/cluster_files/figure-html/unnamed-chunk-5-1.svg" width="576" /></p>
<p>What you can see from the plot is that the clustering algorithm explained the x-y scatter plot by positing the existence of 8 groups of observations, each covering a different area in the overall space. In other words, the clustering algorithm is trying to describe 2 correlated variables when the only tool it has is to group people. As long as there is in fact a correlation between the two variables, then you are going to need more than one group to describe the data (unless you start to use more flexible models).</p>
<p>So in most cases it is trivially easy to find groups. The challenge is of course to ascribe meaning to them. If we return to the linear regression, we might want to infer that x is a cause of y based on the observed relationship. However, we’d be foolish to do so without other information to support the causal claim. Similarly, you can pretend that data-driven clusters are revealing some deeper truth, but again, without other corroborating information, I wouldn’t be making strong claims.</p>
<p>For additional thoughts, <a href="https://twitter.com/f2harrell">Frank Harrell</a> also blogged about this <a href="http://www.fharrell.com/post/errmed/#cluster">here</a>; and <a href="https://twitter.com/MaartenvSmeden">Maarten van Smeden</a> did some other simulation work described <a href="https://twitter.com/MaartenvSmeden/status/970237614413570048">here</a>.</p>

					</div>
				</article>
                

			</div>
		</div>

		<center class="">
			<ul class="pagination">
                

<ul class="pagination">
    
    <li>
        <a href="/post/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li
    class="disabled">
    <a href="" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li
    class="active"><a href="/post/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/post/page/2/">2</a></li>
    
    
    <li
    >
    <a href="/post/page/2/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li>
        <a href="/post/page/2/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>

			</ul>
		</center>


	</div>	

</main>

<footer id="footer">
	<div class="container">
		<div class="row">
			
			<div class="col-md-3 widget">
				<h3 class="widget-title">Contact</h3>
				<div class="widget-body">
					<p><br>
						
						<br>
						Darren L Dahly, PhD
						<br>
						Principal Statistician
						<br>
						University College Cork
						<br>
						<a href="mailto:ddahly@ucc.ie">ddahly@ucc.ie</a><br>
					</p>
				</div>
			</div>
			

			
			<div class="col-md-3 widget">
				<h3 class="widget-title">Follow us</h3>
				<div class="widget-body">
					<p class="follow-me-icons">
                        
                            
                                <a href="https://twitter.com/statsepi" target="_blank"><i class="fa fa-twitter-square fa-2"></i></a>
                            
                        
                            
                                <a href="https://github.com/crfcsdau" target="_blank"><i class="fa fa-github fa-2"></i></a>
                            
                        
                            
                                <a href="mailto:ddahly@ucc.ie" target="_blank"><i class="fa fa-envelope fa-2"></i></a>
                            
                        
					</p>
				</div>
			</div>
			

			

			

		</div> 
	</div>
</footer>

<footer id="underfooter">
	<div class="container">
		<div class="row">

			<div class="col-md-6 widget">
				<div class="widget-body">
					<p>University College Cork</p>
				</div>
			</div>

			<div class="col-md-6 widget">
				<div class="widget-body">
					<p class="text-right">
						Copyright &copy; 2018, Statistics and Data Analysis Unit<br>
						Design: <a href="http://www.gettemplate.com" rel="designer">Initio by GetTemplate</a> - 
                        Powered by: <a href="https://gohugo.io/" rel="poweredby">Hugo</a>
                    </p>
				</div>
			</div>

		</div> 
	</div>
</footer>




<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<script src="/js/template.js"></script>
<script id="dsq-count-scr" src="//hugo-initio-site.disqus.com/count.js" async></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'GA-000000000-0', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>

